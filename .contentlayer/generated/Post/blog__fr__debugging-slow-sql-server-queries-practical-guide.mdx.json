{
  "title": "Déboguer les Requêtes SQL Server Lentes : Guide Pratique pour Développeurs",
  "date": "2025-07-31T00:00:00.000Z",
  "language": "fr",
  "category": "Development",
  "image": "/images/articles/sql-performance.png",
  "description": "Apprenez à identifier et optimiser systématiquement les requêtes SQL Server lentes en utilisant les plans d'exécution, les outils de profilage et des techniques éprouvées.",
  "timeToRead": 12,
  "alternates": {
    "en": "debugging-slow-sql-server-queries-practical-guide",
    "fr": "debugging-slow-sql-server-queries-practical-guide"
  },
  "body": {
    "raw": "\nLa semaine dernière, une requête de rapport apparemment simple prenait 45 secondes à s'exécuter dans notre environnement SQL Server de production. Les utilisateurs expiraient, l'application rampait, et le serveur de base de données atteignait 90% d'utilisation CPU. Ça vous dit quelque chose ? Laissez-moi vous guider à travers l'approche systématique que j'ai utilisée pour réduire ce temps de requête à moins de 2 secondes.\n\n## Le Problème de Performance SQL\n\nVoici la requête qui causait tous ces problèmes :\n\n```sql\nSELECT\n    u.FirstName + ' ' + u.LastName as CustomerName,\n    COUNT(o.OrderID) as TotalOrders,\n    AVG(oi.UnitPrice * oi.Quantity) as AvgOrderValue,\n    MAX(o.OrderDate) as LastOrderDate\nFROM Users u\nLEFT JOIN Orders o ON u.UserID = o.UserID\nLEFT JOIN OrderItems oi ON o.OrderID = oi.OrderID\nWHERE u.CreatedDate >= '2024-01-01'\n    AND o.Status IN ('Completed', 'Shipped')\n    AND u.IsActive = 1\nGROUP BY u.UserID, u.FirstName, u.LastName\nHAVING COUNT(o.OrderID) > 5\nORDER BY AvgOrderValue DESC;\n```\n\n**Les symptômes :**\n\n- Temps d'exécution : 45 secondes\n- Utilisation CPU : 90%\n- 15 000+ utilisateurs attendant les rapports\n- Timeouts d'application augmentant la frustration des utilisateurs\n\nLa base de données contenait 2,5 millions d'utilisateurs, 12 millions de commandes, et 45 millions d'articles de commandes. Un scénario d'entreprise typique que beaucoup de développeurs rencontrent.\n\n## Étape 1 : Lire les Plans d'Exécution SQL Server\n\nLa première étape dans toute investigation de performance SQL Server est de comprendre ce que le moteur de base de données fait réellement.\n\n### Obtenir le Plan d'Exécution\n\n```sql\nSET STATISTICS IO ON;\nSET STATISTICS TIME ON;\n\n-- Inclure le plan d'exécution réel\nSET SHOWPLAN_ALL OFF;\n\n-- Votre requête problématique ici\nSELECT u.FirstName + ' ' + u.LastName as CustomerName...\n```\n\n### Lire le Plan\n\nLe plan d'exécution a révélé plusieurs signaux d'alarme :\n\n```\n|--Sort (Cost: 15%)\n   |--Stream Aggregate (Cost: 8%)\n      |--Hash Match (Inner Join, Cost: 45%)\n         |--Hash Match (Inner Join, Cost: 25%)\n            |--Clustered Index Scan (Users) (Cost: 12%)\n            |--Clustered Index Scan (Orders) (Cost: 18%)  ← SIGNAL D'ALARME\n         |--Clustered Index Scan (OrderItems) (Cost: 35%) ← SIGNAL D'ALARME\n```\n\n**Indicateurs clés de problèmes :**\n\n- **Clustered Index Scans** au lieu de seeks (scans de table complets)\n- **Opérations à coût élevé** (>20% du total)\n- **Hash joins** sur de larges datasets sans index appropriés\n- **Avertissements d'index manquants** dans le plan d'exécution\n\n## Étape 2 : Analyse d'Index SQL Server\n\n### Identifier les Index Manquants\n\nSQL Server fournit d'excellents outils intégrés pour les recommandations d'index via ses DMVs Missing Index. Voici la requête complète pour identifier les index manquants les plus impactants :\n\n```sql\n-- Recommandations d'index manquants avec analyse détaillée\nSELECT\n    -- Calcul du score de priorité\n    migs.avg_total_user_cost * (migs.avg_user_impact / 100.0) * (migs.user_seeks + migs.user_scans) AS improvement_measure,\n\n    -- Instruction CREATE INDEX auto-générée (par défaut NONCLUSTERED)\n    'CREATE NONCLUSTERED INDEX [IX_' + OBJECT_NAME(mid.object_id) + '_' + REPLACE(REPLACE(REPLACE(ISNULL(mid.equality_columns,''), ', ', '_'), '[', ''), ']', '') +\n    CASE WHEN mid.inequality_columns IS NOT NULL THEN '_' + REPLACE(REPLACE(REPLACE(mid.inequality_columns, ', ', '_'), '[', ''), ']', '') ELSE '' END + ']' +\n    ' ON ' + mid.statement + ' (' + ISNULL (mid.equality_columns,'') +\n    CASE WHEN mid.equality_columns IS NOT NULL AND mid.inequality_columns IS NOT NULL THEN ',' ELSE '' END +\n    ISNULL (mid.inequality_columns, '') + ')' + ISNULL (' INCLUDE (' + mid.included_columns + ')', '') AS create_index_statement,\n\n    -- Métriques détaillées pour l'analyse\n    OBJECT_NAME(mid.object_id) AS table_name,\n    mid.equality_columns,\n    mid.inequality_columns,\n    mid.included_columns,\n    migs.user_seeks,\n    migs.user_scans,\n    migs.avg_total_user_cost,\n    migs.avg_user_impact,\n    migs.system_seeks,\n    migs.system_scans,\n    migs.last_user_seek,\n    migs.last_user_scan\nFROM sys.dm_db_missing_index_groups mig\nINNER JOIN sys.dm_db_missing_index_group_stats migs ON migs.group_handle = mig.index_group_handle\nINNER JOIN sys.dm_db_missing_index_details mid ON mig.index_handle = mid.index_handle\nWHERE migs.avg_total_user_cost * (migs.avg_user_impact / 100.0) * (migs.user_seeks + migs.user_scans) > 10\nORDER BY migs.avg_total_user_cost * migs.avg_user_impact * (migs.user_seeks + migs.user_scans) DESC;\n```\n\n#### Comprendre les Résultats\n\nDétaillons ce que signifie chaque colonne et comment interpréter les résultats :\n\n**Métriques de Priorité :**\n\n- **`improvement_measure`** : C'est votre score de priorisation. Il combine :\n  - `avg_total_user_cost` : Le coût moyen des requêtes utilisateur qui pourrait être réduit par cet index\n  - `avg_user_impact` : Le pourcentage d'amélioration que cet index fournirait (0-100)\n  - `user_seeks + user_scans` : Combien de fois cet index aurait été utilisé\n\n```sql\n-- Décomposition de la formule :\n-- improvement_measure = coût × (impact/100) × utilisation\n-- Exemple : 1000 × (85/100) × 150 = 127,500\n```\n\n**Statistiques d'Utilisation :**\n\n- **`user_seeks`** : Nombre de seeks que cet index aurait satisfait\n- **`user_scans`** : Nombre de scans que cet index aurait satisfait\n- **`system_seeks/scans`** : Mêmes métriques mais pour les requêtes système\n- **`last_user_seek/scan`** : Quand cet index a été recommandé pour la dernière fois\n\n**Structure d'Index :**\n\n- **`equality_columns`** : Colonnes utilisées dans les clauses WHERE avec des opérateurs `=` (égal)\n- **`inequality_columns`** : Colonnes utilisées dans les clauses WHERE avec des opérateurs comme `>`, `<`, `>=`, `<=`, `BETWEEN`, etc.\n- **`included_columns`** : Colonnes additionnelles ajoutées à l'index (en utilisant `INCLUDE`) pour couvrir les requêtes, afin que toutes les données nécessaires puissent être récupérées depuis l'index sans consulter la table principale\n\n**Note Importante :** Les instructions auto-générées créent des index **NONCLUSTERED** par défaut, ce qui est ce que vous voulez dans 99% des cas. La plupart des tables ont déjà un index clustered (typiquement la clé primaire), et vous ne pouvez pas créer un autre index clustered sur la même table.\n\n#### Exemple de Sortie Réel\n\nVoici ce que la requête a retourné pour notre scénario problématique :\n\n```\nimprovement_measure: 245,750.5\ntable_name: Users\nequality_columns: [CreatedDate], [IsActive]\ninequality_columns: NULL\nincluded_columns: [UserID], [FirstName], [LastName]\nuser_seeks: 1,250\navg_total_user_cost: 1,850.2\navg_user_impact: 89.5\nlast_user_seek: 2025-07-31 14:32:15.123\n\nimprovement_measure: 189,420.8\ntable_name: Orders\nequality_columns: [UserID], [Status]\ninequality_columns: NULL\nincluded_columns: [OrderID], [OrderDate]\nuser_seeks: 2,100\navg_total_user_cost: 945.7\navg_user_impact: 95.2\n```\n\n#### Interpréter Ces Résultats\n\n**Index Haute Priorité (improvement_measure > 100,000) :**\n\n- **Table Users** : L'index éliminerait 1 250 seeks coûteux, chacun coûtant en moyenne 1 850 unités, avec 89,5% d'amélioration potentielle\n- **Table Orders** : Pourcentage d'impact encore plus élevé (95,2%) mais coût individuel plus faible\n\n**Décisions de Conception d'Index :**\n\nAvant d'implémenter les recommandations, il est important de comprendre la différence entre les index **CLUSTERED** et **NONCLUSTERED** :\n\n- **CLUSTERED INDEX** : Réordonne physiquement les données de la table. Chaque table ne peut avoir qu'un seul index clustered (généralement la clé primaire)\n- **NONCLUSTERED INDEX** : Crée une structure séparée qui pointe vers les lignes de la table. Une table peut avoir jusqu'à 999 index nonclustered\n\nPuisque nos tables ont déjà des clés primaires (index clustered), nous devons créer des index **NONCLUSTERED** :\n\n```sql\n-- Index 1 : Table Users\n-- equality_columns = [CreatedDate], [IsActive] → Vont dans la clé\n-- included_columns = [UserID], [FirstName], [LastName] → Vont dans INCLUDE\nCREATE NONCLUSTERED INDEX [IX_Users_CreatedDate_IsActive]\nON [Users] ([CreatedDate], [IsActive])\nINCLUDE ([UserID], [FirstName], [LastName]);\n\n-- Pourquoi cette structure ?\n-- 1. WHERE u.CreatedDate >= '2024-01-01' AND u.IsActive = 1 → Couvert par les colonnes clés\n-- 2. SELECT colonnes (UserID, FirstName, LastName) → Couvert par les colonnes incluses\n-- 3. Résultat : L'index couvre toute la requête sans lookups de clés\n\n-- Pourquoi NONCLUSTERED ?\n-- - La table Users a déjà un index clustered sur UserID (clé primaire)\n-- - Nous ne pouvons pas changer l'ordre physique de la table\n-- - Les index NONCLUSTERED sont parfaits pour améliorer des patterns de requêtes spécifiques\n```\n\n#### Avertissements Importants\n\n**Faux Positifs à Surveiller :**\n\n```sql\n-- Vérifier si la recommandation a du sens\nSELECT\n    OBJECT_NAME(mid.object_id) AS table_name,\n    mid.equality_columns,\n    (SELECT COUNT(*) FROM sys.indexes WHERE object_id = mid.object_id) as existing_index_count,\n    -- Vérification de la taille de la table\n    (SELECT SUM(rows) FROM sys.partitions WHERE object_id = mid.object_id AND index_id IN (0,1)) as row_count\nFROM sys.dm_db_missing_index_details mid\nWHERE mid.object_id = OBJECT_ID('Users');\n```\n\n**Signaux d'Alarme :**\n\n- **Trop de colonnes** : Si `equality_columns` a 5+ colonnes, considérez de diviser\n- **Grandes colonnes incluses** : Évitez d'inclure de grandes colonnes VARCHAR ou NVARCHAR\n- **Faible utilisation** : Si `user_seeks + user_scans < 100`, l'index pourrait ne pas en valoir la peine\n- **Index qui se chevauchent** : Vérifiez les index existants avant d'en créer de nouveaux\n\nCette requête a révélé trois index manquants critiques :\n\n```sql\n-- Index 1 : Filtrage de la table Users\nCREATE NONCLUSTERED INDEX [IX_Users_CreatedDate_IsActive]\nON [Users] ([CreatedDate], [IsActive])\nINCLUDE ([UserID], [FirstName], [LastName]);\n\n-- Index 2 : Joins et filtrage de la table Orders\nCREATE NONCLUSTERED INDEX [IX_Orders_UserID_Status]\nON [Orders] ([UserID], [Status])\nINCLUDE ([OrderID], [OrderDate]);\n\n-- Index 3 : Agrégation OrderItems\nCREATE NONCLUSTERED INDEX [IX_OrderItems_OrderID]\nON [OrderItems] ([OrderID])\nINCLUDE ([UnitPrice], [Quantity]);\n```\n\n### Statistiques d'Utilisation d'Index\n\n```sql\n-- Vérifier l'utilisation des index existants\nSELECT\n    OBJECT_NAME(s.object_id) AS TableName,\n    i.name AS IndexName,\n    s.user_seeks,\n    s.user_scans,\n    s.user_lookups,\n    s.user_updates,\n    s.last_user_seek,\n    s.last_user_scan,\n    s.last_user_lookup\nFROM sys.dm_db_index_usage_stats s\nINNER JOIN sys.indexes i ON s.object_id = i.object_id AND s.index_id = i.index_id\nWHERE OBJECT_NAME(s.object_id) IN ('Users', 'Orders', 'OrderItems')\nORDER BY s.user_seeks + s.user_scans + s.user_lookups DESC;\n```\n\n## Étape 3 : Techniques de Réécriture de Requêtes\n\nAprès avoir ajouté les index, j'ai réécrit la requête pour être plus efficace :\n\n```sql\n-- Version optimisée utilisant CTE et meilleure stratégie de join\nWITH ActiveUserOrders AS (\n    SELECT\n        o.UserID,\n        COUNT(o.OrderID) as OrderCount,\n        MAX(o.OrderDate) as LastOrderDate\n    FROM Orders o WITH (NOLOCK)\n    WHERE o.Status IN ('Completed', 'Shipped')\n    GROUP BY o.UserID\n    HAVING COUNT(o.OrderID) > 5\n),\nOrderValues AS (\n    SELECT\n        o.UserID,\n        AVG(oi.UnitPrice * oi.Quantity) as AvgOrderValue\n    FROM Orders o WITH (NOLOCK)\n    INNER JOIN OrderItems oi WITH (NOLOCK) ON o.OrderID = oi.OrderID\n    WHERE o.Status IN ('Completed', 'Shipped')\n    GROUP BY o.UserID\n)\nSELECT\n    u.FirstName + ' ' + u.LastName as CustomerName,\n    auo.OrderCount as TotalOrders,\n    ov.AvgOrderValue,\n    auo.LastOrderDate\nFROM Users u WITH (NOLOCK)\nINNER JOIN ActiveUserOrders auo ON u.UserID = auo.UserID\nINNER JOIN OrderValues ov ON u.UserID = ov.UserID\nWHERE u.CreatedDate >= '2024-01-01'\n    AND u.IsActive = 1\nORDER BY ov.AvgOrderValue DESC;\n```\n\n**Optimisations clés :**\n\n- **CTEs** pour décomposer les agrégations complexes\n- **Hints NOLOCK** pour les rapports en lecture seule (à utiliser avec précaution !)\n- **INNER JOINs** au lieu de LEFT JOINs quand possible\n- **Agrégations séparées** pour réduire l'utilisation mémoire\n\n## Étape 4 : Outils Avancés de Profilage SQL Server\n\n### Query Store (SQL Server 2016+)\n\nQuery Store est la solution intégrée de monitoring de performance de SQL Server :\n\n```sql\n-- Activer Query Store\nALTER DATABASE [YourDatabase] SET QUERY_STORE = ON;\n\n-- Configurer les paramètres Query Store\nALTER DATABASE [YourDatabase] SET QUERY_STORE (\n    OPERATION_MODE = READ_WRITE,\n    CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 30),\n    DATA_FLUSH_INTERVAL_SECONDS = 900,\n    INTERVAL_LENGTH_MINUTES = 60,\n    MAX_STORAGE_SIZE_MB = 1024,\n    QUERY_CAPTURE_MODE = AUTO,\n    SIZE_BASED_CLEANUP_MODE = AUTO\n);\n\n-- Trouver les requêtes qui consomment le plus de ressources\nSELECT\n    qsq.query_id,\n    qsqt.query_sql_text,\n    qsrs.count_executions,\n    qsrs.avg_duration,\n    qsrs.avg_cpu_time,\n    qsrs.avg_logical_io_reads\nFROM sys.query_store_query qsq\nINNER JOIN sys.query_store_query_text qsqt ON qsq.query_text_id = qsqt.query_text_id\nINNER JOIN sys.query_store_runtime_stats qsrs ON qsq.query_id = qsrs.query_id\nWHERE qsrs.avg_duration > 5000000  -- 5 secondes\nORDER BY qsrs.avg_duration DESC;\n```\n\n### Dynamic Management Views (DMVs)\n\nSQL Server fournit d'excellentes DMVs pour l'analyse de performance :\n\n```sql\n-- Requêtes qui consomment le plus de CPU\nSELECT TOP 10\n    total_worker_time/execution_count AS avg_cpu_time,\n    execution_count,\n    total_elapsed_time/execution_count AS avg_elapsed_time,\n    SUBSTRING(st.text, (qs.statement_start_offset/2) + 1,\n        ((CASE statement_end_offset\n            WHEN -1 THEN DATALENGTH(st.text)\n            ELSE qs.statement_end_offset END\n            - qs.statement_start_offset)/2) + 1) AS statement_text\nFROM sys.dm_exec_query_stats AS qs\nCROSS APPLY sys.dm_exec_sql_text(qs.sql_handle) AS st\nORDER BY total_worker_time/execution_count DESC;\n\n-- Analyse des locks et blocages\nSELECT\n    r.session_id,\n    r.blocking_session_id,\n    r.wait_type,\n    r.wait_time,\n    r.cpu_time,\n    t.text AS sql_text\nFROM sys.dm_exec_requests r\nCROSS APPLY sys.dm_exec_sql_text(r.sql_handle) t\nWHERE r.blocking_session_id <> 0\n    OR r.session_id IN (SELECT blocking_session_id FROM sys.dm_exec_requests WHERE blocking_session_id <> 0);\n```\n\n### Extended Events\n\nRemplacement moderne de SQL Profiler avec un impact minimal sur les performances :\n\n```sql\n-- Créer une session extended events pour le monitoring de performance\nCREATE EVENT SESSION [PerformanceMonitoring] ON SERVER\nADD EVENT sqlserver.sql_statement_completed(\n    ACTION(sqlserver.client_app_name, sqlserver.database_name, sqlserver.sql_text, sqlserver.username)\n    WHERE ([duration]>(1000000) AND [logical_reads]>(1000))  -- 1 seconde et 1000 lectures logiques\n),\nADD EVENT sqlserver.rpc_completed(\n    ACTION(sqlserver.client_app_name, sqlserver.database_name, sqlserver.sql_text, sqlserver.username)\n    WHERE ([duration]>(1000000) AND [logical_reads]>(1000))\n)\nADD TARGET package0.event_file(\n    SET filename=N'C:\\temp\\PerformanceMonitoring.xel',\n        max_file_size=(50)\n)\nWITH (MAX_MEMORY=4096 KB, EVENT_RETENTION_MODE=ALLOW_SINGLE_EVENT_LOSS, MAX_DISPATCH_LATENCY=30 SECONDS,\n      MAX_EVENT_SIZE=0 KB, MEMORY_PARTITION_MODE=NONE, TRACK_CAUSALITY=OFF, STARTUP_STATE=OFF);\n\n-- Démarrer la session\nALTER EVENT SESSION [PerformanceMonitoring] ON SERVER STATE = START;\n```\n\n### Outils Tiers\n\n**SQL Sentry (SentryOne)**\n\n- Monitoring de performance en temps réel\n- Analyse de deadlocks\n- Analyse du cache de plans\n\n**Redgate SQL Monitor**\n\n- Monitoring complet de SQL Server\n- Alertes personnalisées et baselines\n- Données de performance historiques\n\n**SolarWinds Database Performance Analyzer**\n\n- Analyse du temps d'attente\n- Détection de blocages et deadlocks\n- Fonctionnalités de planification de capacité\n\n## Résultats de Performance\n\nAprès l'implémentation des optimisations, voici les améliorations mesurées :\n\n| Métrique                  | Avant       | Après       | Amélioration            |\n| ------------------------- | ----------- | ----------- | ----------------------- |\n| **Temps d'Exécution**     | 45 secondes | 1,8 secondes| **96% plus rapide**     |\n| **Utilisation CPU**       | 90%         | 15%         | **Réduction de 83%**    |\n| **Lectures Logiques**     | 2,8M pages  | 45K pages   | **98% moins de lectures**|\n| **Utilisation Mémoire**   | 850 MB      | 12 MB       | **99% moins de mémoire**|\n| **Utilisateurs Simultanés**| 50 (max)   | 500+        | **Capacité x10**        |\n\n### Analyse Query Store Avant/Après\n\n```sql\n-- Comparer les performances avant et après optimisation\nSELECT\n    qsq.query_id,\n    qsp.plan_id,\n    qsrs.avg_duration / 1000.0 AS avg_duration_ms,\n    qsrs.avg_cpu_time / 1000.0 AS avg_cpu_ms,\n    qsrs.avg_logical_io_reads,\n    qsrs.count_executions,\n    qsrs.first_execution_time,\n    qsrs.last_execution_time\nFROM sys.query_store_runtime_stats qsrs\nINNER JOIN sys.query_store_plan qsp ON qsrs.plan_id = qsp.plan_id\nINNER JOIN sys.query_store_query qsq ON qsp.query_id = qsq.query_id\nWHERE qsq.query_id = 12345  -- Votre query ID spécifique\nORDER BY qsrs.first_execution_time DESC;\n```\n\n## Bonnes Pratiques et Prévention\n\n### Checklist de Développement\n\n1. **Toujours tester avec des données de taille production**\n\n   ```sql\n   -- Créer des données de test qui correspondent à l'échelle de production\n   INSERT INTO TestUsers SELECT TOP 1000000 * FROM Users ORDER BY NEWID();\n   ```\n\n2. **Inclure les plans d'exécution dans les revues de code**\n\n   ```sql\n   -- Inclure dans les descriptions de pull request\n   SET STATISTICS IO ON;\n   SET SHOWPLAN_ALL ON;\n   -- Votre requête ici\n   ```\n\n3. **Mettre en place un monitoring proactif**\n   ```sql\n   -- Créer des alertes pour les requêtes lentes\n   EXEC msdb.dbo.sp_add_alert\n       @name = N'Long Running Query Alert',\n       @message_id = 0,\n       @severity = 0,\n       @performance_condition = N'SQLServer:SQL Statistics|Batch Requests/sec||>|1000';\n   ```\n\n### Requêtes pour Dashboard de Monitoring\n\n```sql\n-- Dashboard de performance en temps réel\nSELECT\n    'Current Blocking' as Metric,\n    COUNT(*) as Value\nFROM sys.dm_exec_requests\nWHERE blocking_session_id > 0\n\nUNION ALL\n\nSELECT\n    'Queries > 5 seconds',\n    COUNT(*)\nFROM sys.dm_exec_requests\nWHERE total_elapsed_time > 5000\n\nUNION ALL\n\nSELECT\n    'CPU Usage %',\n    AVG(cpu_percent)\nFROM sys.dm_db_resource_stats\nWHERE end_time > DATEADD(minute, -5, GETDATE());\n```\n\n## Conclusion\n\nL'optimisation de performance SQL Server est un processus systématique, pas du hasard. En suivant cette méthodologie - plans d'exécution, analyse d'index manquants, réécriture de requêtes, et monitoring continu - vous pouvez transformer des requêtes lentes en requêtes efficaces.\n\nLes leçons clés de cette transformation de 45 secondes à 1,8 secondes :\n\n1. **Commencer avec les plans d'exécution** pour comprendre le vrai problème\n2. **Utiliser les outils intégrés de SQL Server** comme Query Store et les DMVs\n3. **Indexer stratégiquement** basé sur les patterns de requêtes réels\n4. **Réécrire les requêtes** pour travailler avec l'optimiseur, pas contre lui\n5. **Monitorer continuellement** pour prévenir les problèmes futurs\n\nRappelez-vous : l'optimisation prématurée est la racine de tous les maux, mais l'optimisation systématique basée sur des données de performance réelles est le fondement d'applications scalables. Mesurez d'abord, optimisez ensuite, et vérifiez toujours vos améliorations avec des métriques concrètes.\n\nLa prochaine fois que vous rencontrez une requête lente, ne devinez pas - suivez ce processus et laissez les données guider vos décisions d'optimisation.\n",
    "code": "var Component=(()=>{var p=Object.create;var t=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var N=(a,n)=>()=>(n||a((n={exports:{}}).exports,n),n.exports),_=(a,n)=>{for(var s in n)t(a,s,{get:n[s],enumerable:!0})},o=(a,n,s,l)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let c of m(n))!k.call(a,c)&&c!==s&&t(a,c,{get:()=>n[c],enumerable:!(l=u(n,c))||l.enumerable});return a};var y=(a,n,s)=>(s=a!=null?p(h(a)):{},o(n||!a||!a.__esModule?t(s,\"default\",{value:a,enumerable:!0}):s,a)),g=a=>o(t({},\"__esModule\",{value:!0}),a);var i=N((I,r)=>{r.exports=_jsx_runtime});var O={};_(O,{default:()=>q,frontmatter:()=>E});var e=y(i()),E={date:\"2025-07-31\",language:\"fr\",title:\"D\\xE9boguer les Requ\\xEAtes SQL Server Lentes : Guide Pratique pour D\\xE9veloppeurs\",category:\"Development\",image:\"/images/articles/sql-performance.png\",description:\"Apprenez \\xE0 identifier et optimiser syst\\xE9matiquement les requ\\xEAtes SQL Server lentes en utilisant les plans d'ex\\xE9cution, les outils de profilage et des techniques \\xE9prouv\\xE9es.\",timeToRead:12,alternates:{en:\"debugging-slow-sql-server-queries-practical-guide\",fr:\"debugging-slow-sql-server-queries-practical-guide\"}};function d(a){let n=Object.assign({p:\"p\",h2:\"h2\",pre:\"pre\",code:\"code\",span:\"span\",strong:\"strong\",ul:\"ul\",li:\"li\",h3:\"h3\",h4:\"h4\",table:\"table\",thead:\"thead\",tr:\"tr\",th:\"th\",tbody:\"tbody\",td:\"td\",ol:\"ol\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:\"La semaine derni\\xE8re, une requ\\xEAte de rapport apparemment simple prenait 45 secondes \\xE0 s'ex\\xE9cuter dans notre environnement SQL Server de production. Les utilisateurs expiraient, l'application rampait, et le serveur de base de donn\\xE9es atteignait 90% d'utilisation CPU. \\xC7a vous dit quelque chose ? Laissez-moi vous guider \\xE0 travers l'approche syst\\xE9matique que j'ai utilis\\xE9e pour r\\xE9duire ce temps de requ\\xEAte \\xE0 moins de 2 secondes.\"}),`\n`,(0,e.jsx)(n.h2,{children:\"Le Probl\\xE8me de Performance SQL\"}),`\n`,(0,e.jsx)(n.p,{children:\"Voici la requ\\xEAte qui causait tous ces probl\\xE8mes :\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n    u`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"FirstName \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"' '\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"LastName \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" CustomerName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"COUNT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"OrderID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" TotalOrders\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"AVG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"oi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"UnitPrice \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" oi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Quantity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" AvgOrderValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"MAX\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"OrderDate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),` LastOrderDate\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),` Users u\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"LEFT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" Orders o \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"UserID \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`UserID\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"LEFT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" OrderItems oi \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"OrderID \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" oi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`OrderID\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"CreatedDate \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'2024-01-01'\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"AND\"}),\" o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"Status\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IN\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Completed'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Shipped'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"AND\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"IsActive \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"GROUP\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"BY\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"UserID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"FirstName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`LastName\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"HAVING\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"COUNT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"OrderID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ORDER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"BY\"}),\" AvgOrderValue \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DESC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Les sympt\\xF4mes :\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Temps d'ex\\xE9cution : 45 secondes\"}),`\n`,(0,e.jsx)(n.li,{children:\"Utilisation CPU : 90%\"}),`\n`,(0,e.jsx)(n.li,{children:\"15 000+ utilisateurs attendant les rapports\"}),`\n`,(0,e.jsx)(n.li,{children:\"Timeouts d'application augmentant la frustration des utilisateurs\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"La base de donn\\xE9es contenait 2,5 millions d'utilisateurs, 12 millions de commandes, et 45 millions d'articles de commandes. Un sc\\xE9nario d'entreprise typique que beaucoup de d\\xE9veloppeurs rencontrent.\"}),`\n`,(0,e.jsx)(n.h2,{children:\"\\xC9tape 1 : Lire les Plans d'Ex\\xE9cution SQL Server\"}),`\n`,(0,e.jsx)(n.p,{children:\"La premi\\xE8re \\xE9tape dans toute investigation de performance SQL Server est de comprendre ce que le moteur de base de donn\\xE9es fait r\\xE9ellement.\"}),`\n`,(0,e.jsx)(n.h3,{children:\"Obtenir le Plan d'Ex\\xE9cution\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SET\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"STATISTICS\"}),\" IO \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SET\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"STATISTICS\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"TIME\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Inclure le plan d'ex\\xE9cution r\\xE9el\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SET\"}),\" SHOWPLAN_ALL \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"OFF\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Votre requ\\xEAte probl\\xE9matique ici\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"FirstName \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"' '\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"LastName \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" CustomerName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`\n`]})}),`\n`,(0,e.jsx)(n.h3,{children:\"Lire le Plan\"}),`\n`,(0,e.jsx)(n.p,{children:\"Le plan d'ex\\xE9cution a r\\xE9v\\xE9l\\xE9 plusieurs signaux d'alarme :\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`|--Sort (Cost: 15%)\n   |--Stream Aggregate (Cost: 8%)\n      |--Hash Match (Inner Join, Cost: 45%)\n         |--Hash Match (Inner Join, Cost: 25%)\n            |--Clustered Index Scan (Users) (Cost: 12%)\n            |--Clustered Index Scan (Orders) (Cost: 18%)  \\u2190 SIGNAL D'ALARME\n         |--Clustered Index Scan (OrderItems) (Cost: 35%) \\u2190 SIGNAL D'ALARME\n`})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Indicateurs cl\\xE9s de probl\\xE8mes :\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Clustered Index Scans\"}),\" au lieu de seeks (scans de table complets)\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Op\\xE9rations \\xE0 co\\xFBt \\xE9lev\\xE9\"}),\" (>20% du total)\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Hash joins\"}),\" sur de larges datasets sans index appropri\\xE9s\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Avertissements d'index manquants\"}),\" dans le plan d'ex\\xE9cution\"]}),`\n`]}),`\n`,(0,e.jsx)(n.h2,{children:\"\\xC9tape 2 : Analyse d'Index SQL Server\"}),`\n`,(0,e.jsx)(n.h3,{children:\"Identifier les Index Manquants\"}),`\n`,(0,e.jsx)(n.p,{children:\"SQL Server fournit d'excellents outils int\\xE9gr\\xE9s pour les recommandations d'index via ses DMVs Missing Index. Voici la requ\\xEAte compl\\xE8te pour identifier les index manquants les plus impactants :\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Recommandations d'index manquants avec analyse d\\xE9taill\\xE9e\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Calcul du score de priorit\\xE9\"}),`\n    migs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_total_user_cost \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_user_impact \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"100.0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_seeks \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_scans\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" improvement_measure\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n\n    `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Instruction CREATE INDEX auto-g\\xE9n\\xE9r\\xE9e (par d\\xE9faut NONCLUSTERED)\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token string\",children:\"'CREATE NONCLUSTERED INDEX [IX_'\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" OBJECT_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"object_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'_'\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"REPLACE\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"REPLACE\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"REPLACE\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"ISNULL\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"equality_columns\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"', '\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'_'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'['\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"']'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CASE\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHEN\"}),\" mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"inequality_columns \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IS\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"NULL\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"THEN\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'_'\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"REPLACE\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"REPLACE\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"REPLACE\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"inequality_columns\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"', '\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'_'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'['\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"']'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ELSE\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"END\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"']'\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token string\",children:\"' ON '\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"statement \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"' ('\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" ISNULL \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"equality_columns\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CASE\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHEN\"}),\" mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"equality_columns \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IS\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"NULL\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"AND\"}),\" mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"inequality_columns \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IS\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"NOT\"}),\" \",(0,e.jsx)(n.span,{className:\"token boolean\",children:\"NULL\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"THEN\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"','\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ELSE\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"END\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),`\n    ISNULL `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"inequality_columns\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"')'\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" ISNULL \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"' INCLUDE ('\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"included_columns \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"')'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" create_index_statement\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n\n    `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- M\\xE9triques d\\xE9taill\\xE9es pour l'analyse\"}),`\n    OBJECT_NAME`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"object_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" table_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    mid`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"equality_columns\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    mid`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"inequality_columns\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    mid`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"included_columns\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    migs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_seeks\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    migs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_scans\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    migs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_total_user_cost\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    migs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_user_impact\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    migs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"system_seeks\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    migs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"system_scans\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    migs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"last_user_seek\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    migs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`last_user_scan\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`dm_db_missing_index_groups mig\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INNER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dm_db_missing_index_group_stats migs \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"group_handle \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" mig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`index_group_handle\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INNER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dm_db_missing_index_details mid \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" mig\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"index_handle \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`index_handle\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_total_user_cost \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_user_impact \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"100.0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_seeks \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_scans\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ORDER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"BY\"}),\" migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_total_user_cost \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_user_impact \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_seeks \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" migs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_scans\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DESC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.h4,{children:\"Comprendre les R\\xE9sultats\"}),`\n`,(0,e.jsx)(n.p,{children:\"D\\xE9taillons ce que signifie chaque colonne et comment interpr\\xE9ter les r\\xE9sultats :\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"M\\xE9triques de Priorit\\xE9 :\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"improvement_measure\"})}),\" : C'est votre score de priorisation. Il combine :\",`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"avg_total_user_cost\"}),\" : Le co\\xFBt moyen des requ\\xEAtes utilisateur qui pourrait \\xEAtre r\\xE9duit par cet index\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"avg_user_impact\"}),\" : Le pourcentage d'am\\xE9lioration que cet index fournirait (0-100)\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"user_seeks + user_scans\"}),\" : Combien de fois cet index aurait \\xE9t\\xE9 utilis\\xE9\"]}),`\n`]}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- D\\xE9composition de la formule :\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- improvement_measure = co\\xFBt \\xD7 (impact/100) \\xD7 utilisation\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Exemple : 1000 \\xD7 (85/100) \\xD7 150 = 127,500\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Statistiques d'Utilisation :\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"user_seeks\"})}),\" : Nombre de seeks que cet index aurait satisfait\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"user_scans\"})}),\" : Nombre de scans que cet index aurait satisfait\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"system_seeks/scans\"})}),\" : M\\xEAmes m\\xE9triques mais pour les requ\\xEAtes syst\\xE8me\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"last_user_seek/scan\"})}),\" : Quand cet index a \\xE9t\\xE9 recommand\\xE9 pour la derni\\xE8re fois\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Structure d'Index :\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"equality_columns\"})}),\" : Colonnes utilis\\xE9es dans les clauses WHERE avec des op\\xE9rateurs \",(0,e.jsx)(n.code,{children:\"=\"}),\" (\\xE9gal)\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"inequality_columns\"})}),\" : Colonnes utilis\\xE9es dans les clauses WHERE avec des op\\xE9rateurs comme \",(0,e.jsx)(n.code,{children:\">\"}),\", \",(0,e.jsx)(n.code,{children:\"<\"}),\", \",(0,e.jsx)(n.code,{children:\">=\"}),\", \",(0,e.jsx)(n.code,{children:\"<=\"}),\", \",(0,e.jsx)(n.code,{children:\"BETWEEN\"}),\", etc.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:(0,e.jsx)(n.code,{children:\"included_columns\"})}),\" : Colonnes additionnelles ajout\\xE9es \\xE0 l'index (en utilisant \",(0,e.jsx)(n.code,{children:\"INCLUDE\"}),\") pour couvrir les requ\\xEAtes, afin que toutes les donn\\xE9es n\\xE9cessaires puissent \\xEAtre r\\xE9cup\\xE9r\\xE9es depuis l'index sans consulter la table principale\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.strong,{children:\"Note Importante :\"}),\" Les instructions auto-g\\xE9n\\xE9r\\xE9es cr\\xE9ent des index \",(0,e.jsx)(n.strong,{children:\"NONCLUSTERED\"}),\" par d\\xE9faut, ce qui est ce que vous voulez dans 99% des cas. La plupart des tables ont d\\xE9j\\xE0 un index clustered (typiquement la cl\\xE9 primaire), et vous ne pouvez pas cr\\xE9er un autre index clustered sur la m\\xEAme table.\"]}),`\n`,(0,e.jsx)(n.h4,{children:\"Exemple de Sortie R\\xE9el\"}),`\n`,(0,e.jsx)(n.p,{children:\"Voici ce que la requ\\xEAte a retourn\\xE9 pour notre sc\\xE9nario probl\\xE9matique :\"}),`\n`,(0,e.jsx)(n.pre,{children:(0,e.jsx)(n.code,{children:`improvement_measure: 245,750.5\ntable_name: Users\nequality_columns: [CreatedDate], [IsActive]\ninequality_columns: NULL\nincluded_columns: [UserID], [FirstName], [LastName]\nuser_seeks: 1,250\navg_total_user_cost: 1,850.2\navg_user_impact: 89.5\nlast_user_seek: 2025-07-31 14:32:15.123\n\nimprovement_measure: 189,420.8\ntable_name: Orders\nequality_columns: [UserID], [Status]\ninequality_columns: NULL\nincluded_columns: [OrderID], [OrderDate]\nuser_seeks: 2,100\navg_total_user_cost: 945.7\navg_user_impact: 95.2\n`})}),`\n`,(0,e.jsx)(n.h4,{children:\"Interpr\\xE9ter Ces R\\xE9sultats\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Index Haute Priorit\\xE9 (improvement_measure > 100,000) :\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Table Users\"}),\" : L'index \\xE9liminerait 1 250 seeks co\\xFBteux, chacun co\\xFBtant en moyenne 1 850 unit\\xE9s, avec 89,5% d'am\\xE9lioration potentielle\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Table Orders\"}),\" : Pourcentage d'impact encore plus \\xE9lev\\xE9 (95,2%) mais co\\xFBt individuel plus faible\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"D\\xE9cisions de Conception d'Index :\"})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Avant d'impl\\xE9menter les recommandations, il est important de comprendre la diff\\xE9rence entre les index \",(0,e.jsx)(n.strong,{children:\"CLUSTERED\"}),\" et \",(0,e.jsx)(n.strong,{children:\"NONCLUSTERED\"}),\" :\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"CLUSTERED INDEX\"}),\" : R\\xE9ordonne physiquement les donn\\xE9es de la table. Chaque table ne peut avoir qu'un seul index clustered (g\\xE9n\\xE9ralement la cl\\xE9 primaire)\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"NONCLUSTERED INDEX\"}),\" : Cr\\xE9e une structure s\\xE9par\\xE9e qui pointe vers les lignes de la table. Une table peut avoir jusqu'\\xE0 999 index nonclustered\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Puisque nos tables ont d\\xE9j\\xE0 des cl\\xE9s primaires (index clustered), nous devons cr\\xE9er des index \",(0,e.jsx)(n.strong,{children:\"NONCLUSTERED\"}),\" :\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Index 1 : Table Users\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- equality_columns = [CreatedDate], [IsActive] \\u2192 Vont dans la cl\\xE9\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- included_columns = [UserID], [FirstName], [LastName] \\u2192 Vont dans INCLUDE\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CREATE\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"NONCLUSTERED\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INDEX\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"IX_Users_CreatedDate_IsActive\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"CreatedDate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"IsActive\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\nINCLUDE `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"UserID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"FirstName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"LastName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Pourquoi cette structure ?\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- 1. WHERE u.CreatedDate >= '2024-01-01' AND u.IsActive = 1 \\u2192 Couvert par les colonnes cl\\xE9s\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- 2. SELECT colonnes (UserID, FirstName, LastName) \\u2192 Couvert par les colonnes incluses\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- 3. R\\xE9sultat : L'index couvre toute la requ\\xEAte sans lookups de cl\\xE9s\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Pourquoi NONCLUSTERED ?\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- - La table Users a d\\xE9j\\xE0 un index clustered sur UserID (cl\\xE9 primaire)\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- - Nous ne pouvons pas changer l'ordre physique de la table\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- - Les index NONCLUSTERED sont parfaits pour am\\xE9liorer des patterns de requ\\xEAtes sp\\xE9cifiques\"}),`\n`]})}),`\n`,(0,e.jsx)(n.h4,{children:\"Avertissements Importants\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Faux Positifs \\xE0 Surveiller :\"})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- V\\xE9rifier si la recommandation a du sens\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n    OBJECT_NAME`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"object_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" table_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    mid`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"equality_columns\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"COUNT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"indexes \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" object_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"object_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" existing_index_count\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- V\\xE9rification de la taille de la table\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"SUM\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"rows\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"partitions \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" object_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"object_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"AND\"}),\" index_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IN\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),` row_count\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`dm_db_missing_index_details mid\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" mid\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"object_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" OBJECT_ID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Users'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Signaux d'Alarme :\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Trop de colonnes\"}),\" : Si \",(0,e.jsx)(n.code,{children:\"equality_columns\"}),\" a 5+ colonnes, consid\\xE9rez de diviser\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Grandes colonnes incluses\"}),\" : \\xC9vitez d'inclure de grandes colonnes VARCHAR ou NVARCHAR\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Faible utilisation\"}),\" : Si \",(0,e.jsx)(n.code,{children:\"user_seeks + user_scans < 100\"}),\", l'index pourrait ne pas en valoir la peine\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Index qui se chevauchent\"}),\" : V\\xE9rifiez les index existants avant d'en cr\\xE9er de nouveaux\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Cette requ\\xEAte a r\\xE9v\\xE9l\\xE9 trois index manquants critiques :\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Index 1 : Filtrage de la table Users\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CREATE\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"NONCLUSTERED\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INDEX\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"IX_Users_CreatedDate_IsActive\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Users\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"CreatedDate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"IsActive\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\nINCLUDE `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"UserID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"FirstName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"LastName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Index 2 : Joins et filtrage de la table Orders\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CREATE\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"NONCLUSTERED\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INDEX\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"IX_Orders_UserID_Status\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Orders\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"UserID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"Status\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\nINCLUDE `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"OrderID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"OrderDate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Index 3 : Agr\\xE9gation OrderItems\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CREATE\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"NONCLUSTERED\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INDEX\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"IX_OrderItems_OrderID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"OrderItems\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"OrderID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\nINCLUDE `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"UnitPrice\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Quantity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.h3,{children:\"Statistiques d'Utilisation d'Index\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- V\\xE9rifier l'utilisation des index existants\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n    OBJECT_NAME`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"s\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"object_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" TableName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    i`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"name \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" IndexName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    s`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_seeks\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    s`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_scans\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    s`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_lookups\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    s`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_updates\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    s`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"last_user_seek\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    s`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"last_user_scan\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    s`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`last_user_lookup\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`dm_db_index_usage_stats s\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INNER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"indexes i \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" s\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"object_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"object_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"AND\"}),\" s\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"index_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`index_id\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" OBJECT_NAME\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"s\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"object_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IN\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Users'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Orders'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'OrderItems'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ORDER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"BY\"}),\" s\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_seeks \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" s\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_scans \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" s\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"user_lookups \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DESC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.h2,{children:\"\\xC9tape 3 : Techniques de R\\xE9\\xE9criture de Requ\\xEAtes\"}),`\n`,(0,e.jsx)(n.p,{children:\"Apr\\xE8s avoir ajout\\xE9 les index, j'ai r\\xE9\\xE9crit la requ\\xEAte pour \\xEAtre plus efficace :\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Version optimis\\xE9e utilisant CTE et meilleure strat\\xE9gie de join\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WITH\"}),\" ActiveUserOrders \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n        o`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"UserID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n        `,(0,e.jsx)(n.span,{className:\"token function\",children:\"COUNT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"OrderID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" OrderCount\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n        `,(0,e.jsx)(n.span,{className:\"token function\",children:\"MAX\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"OrderDate\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),` LastOrderDate\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" Orders o \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WITH\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"NOLOCK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"Status\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IN\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Completed'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Shipped'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"GROUP\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"BY\"}),\" o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`UserID\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"HAVING\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"COUNT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"OrderID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\nOrderValues `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n        o`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"UserID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n        `,(0,e.jsx)(n.span,{className:\"token function\",children:\"AVG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"oi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"UnitPrice \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" oi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Quantity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),` AvgOrderValue\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" Orders o \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WITH\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"NOLOCK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INNER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" OrderItems oi \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WITH\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"NOLOCK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"OrderID \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" oi\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`OrderID\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"Status\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IN\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Completed'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Shipped'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"GROUP\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"BY\"}),\" o\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`UserID\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n    u`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"FirstName \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"' '\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"LastName \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" CustomerName\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    auo`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"OrderCount \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" TotalOrders\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    ov`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"AvgOrderValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    auo`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`LastOrderDate\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" Users u \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WITH\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"NOLOCK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INNER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" ActiveUserOrders auo \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"UserID \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" auo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`UserID\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INNER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" OrderValues ov \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"UserID \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" ov\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`UserID\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"CreatedDate \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'2024-01-01'\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"AND\"}),\" u\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"IsActive \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ORDER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"BY\"}),\" ov\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"AvgOrderValue \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DESC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Optimisations cl\\xE9s :\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"CTEs\"}),\" pour d\\xE9composer les agr\\xE9gations complexes\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Hints NOLOCK\"}),\" pour les rapports en lecture seule (\\xE0 utiliser avec pr\\xE9caution !)\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"INNER JOINs\"}),\" au lieu de LEFT JOINs quand possible\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Agr\\xE9gations s\\xE9par\\xE9es\"}),\" pour r\\xE9duire l'utilisation m\\xE9moire\"]}),`\n`]}),`\n`,(0,e.jsx)(n.h2,{children:\"\\xC9tape 4 : Outils Avanc\\xE9s de Profilage SQL Server\"}),`\n`,(0,e.jsx)(n.h3,{children:\"Query Store (SQL Server 2016+)\"}),`\n`,(0,e.jsx)(n.p,{children:\"Query Store est la solution int\\xE9gr\\xE9e de monitoring de performance de SQL Server :\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Activer Query Store\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ALTER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DATABASE\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"YourDatabase\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SET\"}),\" QUERY_STORE \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Configurer les param\\xE8tres Query Store\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ALTER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DATABASE\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"YourDatabase\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SET\"}),\" QUERY_STORE \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n    OPERATION_MODE `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" READ_WRITE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    CLEANUP_POLICY `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"STALE_QUERY_THRESHOLD_DAYS \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"30\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    DATA_FLUSH_INTERVAL_SECONDS `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"900\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    INTERVAL_LENGTH_MINUTES `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    MAX_STORAGE_SIZE_MB `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1024\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    QUERY_CAPTURE_MODE `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" AUTO\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    SIZE_BASED_CLEANUP_MODE `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),` AUTO\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Trouver les requ\\xEAtes qui consomment le plus de ressources\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n    qsq`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"query_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsqt`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"query_sql_text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsrs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"count_executions\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsrs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_duration\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsrs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_cpu_time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsrs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`avg_logical_io_reads\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`query_store_query qsq\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INNER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"query_store_query_text qsqt \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" qsq\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"query_text_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" qsqt\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`query_text_id\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INNER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"query_store_runtime_stats qsrs \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" qsq\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"query_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" qsrs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`query_id\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" qsrs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_duration \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5000000\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- 5 secondes\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ORDER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"BY\"}),\" qsrs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_duration \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DESC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.h3,{children:\"Dynamic Management Views (DMVs)\"}),`\n`,(0,e.jsx)(n.p,{children:\"SQL Server fournit d'excellentes DMVs pour l'analyse de performance :\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Requ\\xEAtes qui consomment le plus de CPU\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"TOP\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"10\"}),`\n    total_worker_time`,(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\"execution_count \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" avg_cpu_time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    execution_count`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    total_elapsed_time`,(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\"execution_count \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" avg_elapsed_time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    SUBSTRING`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"st\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"text\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"qs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"statement_start_offset\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n        `,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CASE\"}),` statement_end_offset\n            `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHEN\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"THEN\"}),\" DATALENGTH\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"st\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"text\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n            `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ELSE\"}),\" qs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"statement_end_offset \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"END\"}),`\n            `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" qs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"statement_start_offset\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"+\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),` statement_text\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dm_exec_query_stats \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),` qs\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CROSS\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"APPLY\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dm_exec_sql_text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"qs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"sql_handle\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),` st\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ORDER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"BY\"}),\" total_worker_time\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\"execution_count \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DESC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Analyse des locks et blocages\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n    r`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"session_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    r`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"blocking_session_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    r`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"wait_type\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    r`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"wait_time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    r`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"cpu_time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    t`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"text\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),` sql_text\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`dm_exec_requests r\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CROSS\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"APPLY\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dm_exec_sql_text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"r\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"sql_handle\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),` t\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" r\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"blocking_session_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<>\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token operator\",children:\"OR\"}),\" r\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"session_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"IN\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" blocking_session_id \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dm_exec_requests \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" blocking_session_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"<>\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.h3,{children:\"Extended Events\"}),`\n`,(0,e.jsx)(n.p,{children:\"Remplacement moderne de SQL Profiler avec un impact minimal sur les performances :\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Cr\\xE9er une session extended events pour le monitoring de performance\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"CREATE\"}),\" EVENT \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SESSION\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"PerformanceMonitoring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),` SERVER\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ADD\"}),\" EVENT sqlserver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"sql_statement_completed\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ACTION\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"sqlserver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"client_app_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" sqlserver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"database_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" sqlserver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"sql_text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" sqlserver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"duration\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000000\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"AND\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"logical_reads\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- 1 seconde et 1000 lectures logiques\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ADD\"}),\" EVENT sqlserver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"rpc_completed\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ACTION\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"sqlserver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"client_app_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" sqlserver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"database_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" sqlserver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"sql_text\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" sqlserver\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"duration\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000000\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"AND\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"logical_reads\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1000\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ADD\"}),\" TARGET package0\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"event_file\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SET\"}),\" filename\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"N\",(0,e.jsx)(n.span,{className:\"token string\",children:\"'C:\\\\temp\\\\PerformanceMonitoring.xel'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n        max_file_size`,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"50\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WITH\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"MAX_MEMORY\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4096\"}),\" KB\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" EVENT_RETENTION_MODE\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"ALLOW_SINGLE_EVENT_LOSS\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" MAX_DISPATCH_LATENCY\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"30\"}),\" SECONDS\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n      MAX_EVENT_SIZE`,(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" KB\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" MEMORY_PARTITION_MODE\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"NONE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" TRACK_CAUSALITY\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"OFF\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" STARTUP_STATE\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"OFF\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- D\\xE9marrer la session\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ALTER\"}),\" EVENT \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SESSION\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"PerformanceMonitoring\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" SERVER STATE \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"START\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.h3,{children:\"Outils Tiers\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"SQL Sentry (SentryOne)\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Monitoring de performance en temps r\\xE9el\"}),`\n`,(0,e.jsx)(n.li,{children:\"Analyse de deadlocks\"}),`\n`,(0,e.jsx)(n.li,{children:\"Analyse du cache de plans\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Redgate SQL Monitor\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Monitoring complet de SQL Server\"}),`\n`,(0,e.jsx)(n.li,{children:\"Alertes personnalis\\xE9es et baselines\"}),`\n`,(0,e.jsx)(n.li,{children:\"Donn\\xE9es de performance historiques\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"SolarWinds Database Performance Analyzer\"})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Analyse du temps d'attente\"}),`\n`,(0,e.jsx)(n.li,{children:\"D\\xE9tection de blocages et deadlocks\"}),`\n`,(0,e.jsx)(n.li,{children:\"Fonctionnalit\\xE9s de planification de capacit\\xE9\"}),`\n`]}),`\n`,(0,e.jsx)(n.h2,{children:\"R\\xE9sultats de Performance\"}),`\n`,(0,e.jsx)(n.p,{children:\"Apr\\xE8s l'impl\\xE9mentation des optimisations, voici les am\\xE9liorations mesur\\xE9es :\"}),`\n`,(0,e.jsxs)(n.table,{children:[(0,e.jsx)(n.thead,{children:(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.th,{children:\"M\\xE9trique\"}),(0,e.jsx)(n.th,{children:\"Avant\"}),(0,e.jsx)(n.th,{children:\"Apr\\xE8s\"}),(0,e.jsx)(n.th,{children:\"Am\\xE9lioration\"})]})}),(0,e.jsxs)(n.tbody,{children:[(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"Temps d'Ex\\xE9cution\"})}),(0,e.jsx)(n.td,{children:\"45 secondes\"}),(0,e.jsx)(n.td,{children:\"1,8 secondes\"}),(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"96% plus rapide\"})})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"Utilisation CPU\"})}),(0,e.jsx)(n.td,{children:\"90%\"}),(0,e.jsx)(n.td,{children:\"15%\"}),(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"R\\xE9duction de 83%\"})})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"Lectures Logiques\"})}),(0,e.jsx)(n.td,{children:\"2,8M pages\"}),(0,e.jsx)(n.td,{children:\"45K pages\"}),(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"98% moins de lectures\"})})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"Utilisation M\\xE9moire\"})}),(0,e.jsx)(n.td,{children:\"850 MB\"}),(0,e.jsx)(n.td,{children:\"12 MB\"}),(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"99% moins de m\\xE9moire\"})})]}),(0,e.jsxs)(n.tr,{children:[(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"Utilisateurs Simultan\\xE9s\"})}),(0,e.jsx)(n.td,{children:\"50 (max)\"}),(0,e.jsx)(n.td,{children:\"500+\"}),(0,e.jsx)(n.td,{children:(0,e.jsx)(n.strong,{children:\"Capacit\\xE9 x10\"})})]})]})]}),`\n`,(0,e.jsx)(n.h3,{children:\"Analyse Query Store Avant/Apr\\xE8s\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Comparer les performances avant et apr\\xE8s optimisation\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n    qsq`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"query_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsp`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"plan_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsrs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_duration \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1000.0\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" avg_duration_ms\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsrs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_cpu_time \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1000.0\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"AS\"}),\" avg_cpu_ms\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsrs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"avg_logical_io_reads\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsrs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"count_executions\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsrs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"first_execution_time\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    qsrs`,(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`last_execution_time\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`query_store_runtime_stats qsrs\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INNER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"query_store_plan qsp \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" qsrs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"plan_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" qsp\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`plan_id\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INNER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"JOIN\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"query_store_query qsq \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),\" qsp\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"query_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" qsq\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`query_id\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" qsq\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"query_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"12345\"}),\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Votre query ID sp\\xE9cifique\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ORDER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"BY\"}),\" qsrs\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"first_execution_time \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"DESC\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.h2,{children:\"Bonnes Pratiques et Pr\\xE9vention\"}),`\n`,(0,e.jsx)(n.h3,{children:\"Checklist de D\\xE9veloppement\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Toujours tester avec des donn\\xE9es de taille production\"})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Cr\\xE9er des donn\\xE9es de test qui correspondent \\xE0 l'\\xE9chelle de production\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INSERT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"INTO\"}),\" TestUsers \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"TOP\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1000000\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" Users \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ORDER\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"BY\"}),\" NEWID\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Inclure les plans d'ex\\xE9cution dans les revues de code\"})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Inclure dans les descriptions de pull request\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SET\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"STATISTICS\"}),\" IO \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SET\"}),\" SHOWPLAN_ALL \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ON\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`,(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Votre requ\\xEAte ici\"}),`\n`]})}),`\n`]}),`\n`,(0,e.jsxs)(n.li,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"Mettre en place un monitoring proactif\"})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Cr\\xE9er des alertes pour les requ\\xEAtes lentes\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"EXEC\"}),\" msdb\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dbo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`sp_add_alert\n    `,(0,e.jsx)(n.span,{className:\"token variable\",children:\"@name\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" N\",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Long Running Query Alert'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token variable\",children:\"@message_id\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token variable\",children:\"@severity\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token variable\",children:\"@performance_condition\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" N\",(0,e.jsx)(n.span,{className:\"token string\",children:\"'SQLServer:SQL Statistics|Batch Requests/sec||>|1000'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`]}),`\n`]}),`\n`,(0,e.jsx)(n.h3,{children:\"Requ\\xEAtes pour Dashboard de Monitoring\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-sql\",children:(0,e.jsxs)(n.code,{className:\"language-sql\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"-- Dashboard de performance en temps r\\xE9el\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token string\",children:\"'Current Blocking'\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" Metric\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"COUNT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"Value\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`dm_exec_requests\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" blocking_session_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"UNION\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ALL\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token string\",children:\"'Queries > 5 seconds'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"COUNT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`dm_exec_requests\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" total_elapsed_time \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"5000\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"UNION\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"ALL\"}),`\n\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"SELECT\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token string\",children:\"'CPU Usage %'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n    `,(0,e.jsx)(n.span,{className:\"token function\",children:\"AVG\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"cpu_percent\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"FROM\"}),\" sys\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`dm_db_resource_stats\n`,(0,e.jsx)(n.span,{className:\"token keyword\",children:\"WHERE\"}),\" end_time \",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"}),\" DATEADD\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"minute\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" GETDATE\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})}),`\n`,(0,e.jsx)(n.h2,{children:\"Conclusion\"}),`\n`,(0,e.jsx)(n.p,{children:\"L'optimisation de performance SQL Server est un processus syst\\xE9matique, pas du hasard. En suivant cette m\\xE9thodologie - plans d'ex\\xE9cution, analyse d'index manquants, r\\xE9\\xE9criture de requ\\xEAtes, et monitoring continu - vous pouvez transformer des requ\\xEAtes lentes en requ\\xEAtes efficaces.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Les le\\xE7ons cl\\xE9s de cette transformation de 45 secondes \\xE0 1,8 secondes :\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Commencer avec les plans d'ex\\xE9cution\"}),\" pour comprendre le vrai probl\\xE8me\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Utiliser les outils int\\xE9gr\\xE9s de SQL Server\"}),\" comme Query Store et les DMVs\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Indexer strat\\xE9giquement\"}),\" bas\\xE9 sur les patterns de requ\\xEAtes r\\xE9els\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"R\\xE9\\xE9crire les requ\\xEAtes\"}),\" pour travailler avec l'optimiseur, pas contre lui\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Monitorer continuellement\"}),\" pour pr\\xE9venir les probl\\xE8mes futurs\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Rappelez-vous : l'optimisation pr\\xE9matur\\xE9e est la racine de tous les maux, mais l'optimisation syst\\xE9matique bas\\xE9e sur des donn\\xE9es de performance r\\xE9elles est le fondement d'applications scalables. Mesurez d'abord, optimisez ensuite, et v\\xE9rifiez toujours vos am\\xE9liorations avec des m\\xE9triques concr\\xE8tes.\"}),`\n`,(0,e.jsx)(n.p,{children:\"La prochaine fois que vous rencontrez une requ\\xEAte lente, ne devinez pas - suivez ce processus et laissez les donn\\xE9es guider vos d\\xE9cisions d'optimisation.\"})]})}function w(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,Object.assign({},a,{children:(0,e.jsx)(d,a)})):d(a)}var q=w;return g(O);})();\n;return Component;"
  },
  "_id": "blog/fr/debugging-slow-sql-server-queries-practical-guide.mdx",
  "_raw": {
    "sourceFilePath": "blog/fr/debugging-slow-sql-server-queries-practical-guide.mdx",
    "sourceFileName": "debugging-slow-sql-server-queries-practical-guide.mdx",
    "sourceFileDir": "blog/fr",
    "contentType": "mdx",
    "flattenedPath": "blog/fr/debugging-slow-sql-server-queries-practical-guide"
  },
  "type": "Post",
  "url": "/fr/blog/debugging-slow-sql-server-queries-practical-guide",
  "slug": "debugging-slow-sql-server-queries-practical-guide"
}